function g(a){a instanceof jQuery&&(a=a[0]);a=a.className.replace("x","").replace("y","").split(" ");return{x:a[0],y:a[1]}}colours=function(a){map={};index=0;return function(b){if(""==b)return"white";void 0==map[b]&&(map[b]=a[index],index++,index+1>index.length&&(index=0));return"#"+map[b]}}(["dce6f1","fde9d9","ebf1de","daeef3"]);
function h(a,b,c){var d=a.parent().parent(),e=a.parent(),d=d.children().index(e),a=e.children().index(a);if(isNaN(b))throw"Depth ("+b+") is not a number";for(b=parseInt(b);1<b;b--)c($(".x"+(d+b-1)+".y"+a))}
function i(a,b,c,d,e){b=b.replace(/\(|\)|<|>/g,"");c=parseInt(c);d=d.replace(/\(|\)|<|>/g,"");e=parseInt(e);isNaN(c)||1>c||c>$("#timetable tr").length?c=1:1<c&&h(a,c,function(a){a.css("display","none")});a.html("<span class='name'>"+b+"</span>");a.attr("rowspan",c);a.css("background-color",colours(b));""!=d&&a.append("<div class='room'>("+d+")</div>");1<c&&a.find(".room").css("padding-top","10%");1<e&&(a=g(a),a.y!=e&&i($(".x"+a.x+".y"+e),b,c,d,-2))}
function j(){for(var a=$.map($("td"),function(a){var b=$(a).find(".name").html();if(!(null==b||""==b)){var b=b.replace(/:|\.|_|,/g,"").replace(" ","_"),c=$(a).find(".room").html(),c=null==c?"":c=c.replace(/:|\.|_|,|\(|\)/g,"").replace(" ","_"),f=$(a).attr("rowspan"),a=g(a),b=a.x+":"+a.y+","+b+","+c;1<f&&(b+=","+f);return b}}),b=0;b<a.length;b++)for(var c=0;c<a.length;c++)c!=b&&a[b]==a[c].substring(0,2)+a[b][2]+a[c].substring(3)&&(a[b]=4==a[b].split(",").length?a[b]+("+"+a[c][2]):a[b]+(",+"+a[c][2]),
a[c]="");a=encodeURI(a.join(".").replace(/\.\./g,".").replace(/(\.$)/g,""));b=$(location).attr("href");b.match(/#.*?$/)?$(location).attr("href",b.replace(/#.*?$/,"#"+a)):$(location).attr("href",b+"#"+a)}function l(){$.map($("td"),function(a){$(a).html("").css("background-color","white").attr("rowspan","1").css("display","block")});j()}
$("td").live("click",function(a){var b=$(a.currentTarget);if(!1==b.hasClass("selected")&&!$(a.target).hasClass("save_entry")){var a=b.find(".name").html(),c=b.find(".room").html(),d=b.attr("rowspan");null==a&&(a="");null==c&&(c="");if(null==d||NaN==d)d=1;1<b.attr("rowspan")&&(h(b,b.attr("rowspan"),function(a){a.css("display","block")}),b.attr("rowspan","1"));b.html('<div>\t<label>Subject Name</label><input class="subject_input" type="text" value="{#name}" />\t<label>Length (hours)</label><input class="time_input" type="text" value="{#hours}" />\t<label>Room</label><input class="room_input" type="text" value="{#room}" />\t<button class="save_entry">Save Entry</button></div>'.replace("{#name}",
a).replace("{#hours}",d).replace("{#room}",c));b.addClass("selected");b[0].focus()}});$(".save_entry").live("click",function(a){var a=$(a.currentTarget).parent().parent(),b=a.children(":first").children(":nth-child(2)").val(),c=a.children(":first").children(":nth-child(4)").val(),d=a.children(":first").children(":nth-child(6)").val();i(a,b,c,d);j();a.removeClass("selected")});
$(document).ready(function(){var a=$(location).attr("href");if(a.match(/#.*?$/))for(var a=decodeURI(a.replace(/^.*?#/,"")).split("."),b=0;b<a.length;b++){var c=a[b].split(","),d=c[0].split(":"),e=c[1].replace("_"," "),k=c[2].replace("_"," ");if(3>=c.length)var c=1,f=-1;else f=c[3].split("+"),2>f.length&&(f[1]=-1),c=f[0],f=f[1];i($(".x"+d[0]+".y"+d[1]),e,c,k,f)}$("#delete_button").click(function(a){a.preventDefault();confirm("Are you sure that you want to delete this timetable?")&&l()});$("#save_button").click(function(a){a.preventDefault();
alert("Add this page as a bookmark or keep a copy of the URL in order to save your timetable.")});$("#share_button").click(function(a){a.preventDefault();confirm("You are being redirected to Facebook in order to share this timetable. If you do not wish to do this then press cancel.")&&(window.location="https://www.facebook.com/dialog/send?app_id=322630987775976&name=My%20Timetable&link="+$(location).attr("href")+"&redirect_uri="+$(location).attr("href"))});$("#print_button").click(function(a){a.preventDefault();
window.print()})});
